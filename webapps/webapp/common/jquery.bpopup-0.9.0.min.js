!function(a){a.fn.bPopup=function(b,c){function u(){F(d.onOpen),k=(g.data("bPopup")||0)+1,l=h+k+"__",n="auto"!==d.position[1],o="auto"!==d.position[0],p="fixed"===d.positionStyle,s=e.outerHeight(!0),t=e.outerWidth(!0),d.loadUrl?v():w()}function v(){switch(d.contentContainer=a(d.contentContainer||e),d.content){case"iframe":a('<iframe class="b-iframe" scrolling="no" frameborder="0"></iframe>').attr("src",d.loadUrl).appendTo(d.contentContainer),F(d.loadCallback),s=e.outerHeight(!0),t=e.outerWidth(!0),w();break;case"image":w(),a("<img />").load(function(){F(d.loadCallback),y(a(this))}).attr("src",d.loadUrl).hide().appendTo(d.contentContainer);break;default:w(),a('<div class="b-ajax-wrapper"></div>').load(d.loadUrl,d.loadData,function(){F(d.loadCallback),y(a(this))}).hide().appendTo(d.contentContainer)}}function w(){d.modal&&a('<div class="b-modal '+l+'"></div>').css({backgroundColor:d.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:d.zIndex+k}).each(function(){d.appending&&a(this).appendTo(d.appendTo)}).fadeTo(d.speed,d.opacity),G(),e.data("bPopup",d).data("id",l).css({left:"slideIn"===d.transition?-1*(r+t):D(!(!d.follow[0]&&o||p)),position:d.positionStyle||"absolute",top:"slideDown"===d.transition?-1*(q+t):E(!(!d.follow[1]&&n||p)),"z-index":d.zIndex+k+1}).each(function(){d.appending&&a(this).appendTo(d.appendTo)}),B(!0)}function x(){return d.modal&&a(".b-modal."+e.data("id")).fadeTo(d.speed,0,function(){a(this).remove()}),B(),!1}function y(a){var b=a.width(),c=a.height();d.contentContainer.css({height:c,width:b}),c<=e.height()&&(c=e.height()),b<=e.width()&&(b=e.width()),s=e.outerHeight(!0),t=e.outerWidth(!0),d.contentContainer.css({height:"auto",width:"auto"}),G(),e.dequeue().animate({left:D(!(!d.follow[0]&&o||p)),top:E(!(!d.follow[1]&&n||p)),height:c,width:b},250,function(){a.show(),m=J()})}function z(){g.data("bPopup",k),e.delegate("."+d.closeClass,"click."+l,x),e.delegate(d.closeId,"click."+l,x),d.modalClose&&a(".b-modal."+l).css("cursor","pointer").bind("click",x),i||!d.follow[0]&&!d.follow[1]||g.bind("scroll."+l,function(){m&&e.dequeue().animate({left:d.follow[0]?D(!p):"auto",top:d.follow[1]?E(!p):"auto"},d.followSpeed,d.followEasing)}).bind("resize."+l,function(){m=J(),m&&(G(),e.dequeue().each(function(){p?a(this).css({left:r,top:q}):a(this).animate({left:d.follow[0]?D(!0):"auto",top:d.follow[1]?E(!0):"auto"},d.followSpeed,d.followEasing)}))}),d.escClose&&f.bind("keydown."+l,function(a){27==a.which&&x()})}function A(){d.scrollBar||a("html").css("overflow","auto"),a(".bModal."+l).unbind("click"),f.unbind("keydown."+l),g.unbind("."+l).data("bPopup",g.data("bPopup")-1>0?g.data("bPopup")-1:null),e.undelegate(d.closeClass,"click."+l,x).data("bPopup",null).hide()}function B(a){switch(d.transition){case"slideIn":e.show().animate({left:a?D(!(!d.follow[0]&&o||p)):-1*(r+t)},d.speed,d.easing,function(){C(a)});break;case"slideDown":e.show().animate({top:a?E(!(!d.follow[1]&&n||p)):-1*(q+s)},d.speed,d.easing,function(){C(a)});break;default:a?e.fadeIn(d.speed,function(){C(a)}):e.stop().fadeOut(d.speed,d.easing,function(){C(a)})}}function C(a){a?(z(),F(c)):(A(),F(d.onClose),d.loadUrl&&(d.contentContainer.empty(),e.css({height:"auto",width:"auto"})))}function D(a){return a?r+f.scrollLeft():r}function E(a){return a?q+f.scrollTop():q}function F(b){a.isFunction(b)&&b.call(e)}function G(){q=n?d.position[1]:H(),r=o?d.position[0]:I(),m=J()}function H(){var a=(K()-s)/2-d.amsl;return j>a?j:a}function I(){return(L()-t)/2}function J(){return K()>e.outerHeight(!0)+j&&L()>e.outerWidth(!0)+j}function K(){return window.innerHeight||g.height()}function L(){return window.innerWidth||g.width()}var d,l,m,n,o,p,q,r,s,t,e,f,g,h,i,j,k;return a.isFunction(b)&&(c=b,b=null),d=a.extend({},a.fn.bPopup.defaults,b),d.scrollBar||a("html").css("overflow","hidden"),e=this,f=a(document),g=a(window),h="__b-popup",i=/OS 6(_\d)+/i.test(navigator.userAgent),j=20,k=0,e.close=function(){d=this.data("bPopup"),l=h+g.data("bPopup")+"__",x()},e.each(function(){a(this).data("bPopup")||u()})},a.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",closeClass:"b-close",closeId:"#b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",zIndex:9997}}(jQuery);