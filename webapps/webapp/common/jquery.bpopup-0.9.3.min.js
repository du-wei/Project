!function(a){a.fn.bPopup=function(b,c){function w(){H(d.onOpen),k=(g.data("bPopup")||0)+1,m=h+k+"__",o="auto"!==d.position[1],p="auto"!==d.position[0],q="fixed"===d.positionStyle,t=e.outerHeight(!0),u=e.outerWidth(!0),d.loadUrl?x():y()}function x(){switch(d.contentContainer=a(d.contentContainer||e),d.content){case"iframe":var b=a('<iframe class="b-iframe" scrolling="no" frameborder="0"></iframe>');b.appendTo(d.contentContainer),t=e.outerHeight(!0),u=e.outerWidth(!0),y(),b.attr("src",d.loadUrl),H(d.loadCallback);break;case"image":y(),a("<img />").load(function(){H(d.loadCallback),A(a(this))}).attr("src",d.loadUrl).hide().appendTo(d.contentContainer);break;default:y(),a('<div class="b-ajax-wrapper"></div>').load(d.loadUrl,d.loadData,function(){H(d.loadCallback),A(a(this))}).hide().appendTo(d.contentContainer)}}function y(){d.modal&&a('<div class="b-modal '+m+'"></div>').css({backgroundColor:d.modalColor,position:"fixed",top:0,right:0,bottom:0,left:0,opacity:0,zIndex:d.zIndex+k}).appendTo(d.appendTo).fadeTo(d.speed,d.opacity),I(),e.data("bPopup",d).data("id",m).css({left:"slideIn"===d.transition?-1*(s+u):F(!(!d.follow[0]&&p||q)),position:d.positionStyle||"absolute",top:"slideDown"===d.transition?-1*(r+u):G(!(!d.follow[1]&&o||q)),"z-index":d.zIndex+k+1}).each(function(){d.appending&&a(this).appendTo(d.appendTo)}),D(!0)}function z(){return d.modal&&a(".b-modal."+e.data("id")).fadeTo(d.speed,0,function(){a(this).remove()}),C(),D(),!1}function A(a){var b=a.width(),c=a.height(),f={};d.contentContainer.css({height:c,width:b}),c>=e.height()&&(f.height=e.height()),b>=e.width()&&(f.width=e.width()),t=e.outerHeight(!0),u=e.outerWidth(!0),I(),d.contentContainer.css({height:"auto",width:"auto"}),f.left=F(!(!d.follow[0]&&p||q)),f.top=G(!(!d.follow[1]&&o||q)),e.animate(f,250,function(){a.show(),n=L()})}function B(){g.data("bPopup",k),e.delegate(".bClose, ."+d.closeClass,"click."+m,z),e.delegate("#bClose, "+d.closeId,"click."+m,z),d.modalClose&&a(".b-modal."+m).css("cursor","pointer").bind("click",z),i||!d.follow[0]&&!d.follow[1]||g.bind("scroll."+m,function(){n&&e.dequeue().animate({left:d.follow[0]?F(!q):"auto",top:d.follow[1]?G(!q):"auto"},d.followSpeed,d.followEasing)}).bind("resize."+m,function(){n=L(),n&&(clearTimeout(v),v=setTimeout(function(){I(),e.dequeue().each(function(){q?a(this).css({left:s,top:r}):a(this).animate({left:d.follow[0]?F(!0):"auto",top:d.follow[1]?G(!0):"auto"},d.followSpeed,d.followEasing)})},50))}),d.escClose&&f.bind("keydown."+m,function(a){27==a.which&&z()})}function C(){d.scrollBar||a("html").css("overflow","auto"),a(".b-modal."+m).unbind("click"),f.unbind("keydown."+m),g.unbind("."+m).data("bPopup",g.data("bPopup")-1>0?g.data("bPopup")-1:null),e.undelegate(".bClose, ."+d.closeClass,"click."+m,z).data("bPopup",null),e.undelegate("#bClose, "+d.closeId,"click."+m,z).data("bPopup",null)}function D(a){switch(d.transition){case"slideIn":e.css({display:"block",opacity:1}).animate({left:a?F(!(!d.follow[0]&&p||q)):f.scrollLeft()-(u||e.outerWidth(!0))-200},d.speed,d.easing,function(){E(a)});break;case"slideDown":e.css({display:"block",opacity:1}).animate({top:a?G(!(!d.follow[1]&&o||q)):f.scrollTop()-(t||e.outerHeight(!0))-200},d.speed,d.easing,function(){E(a)});break;default:e.stop().fadeTo(d.speed,a?1:0,function(){E(a)})}}function E(a){a?(B(),H(c)):(e.hide(),H(d.onClose),d.loadUrl&&(d.contentContainer.empty(),e.css({height:"auto",width:"auto"})))}function F(a){return a?s+f.scrollLeft():s}function G(a){return a?r+f.scrollTop():r}function H(b){a.isFunction(b)&&b.call(e)}function I(){r=o?d.position[1]:J(),s=p?d.position[0]:K(),n=L()}function J(){var a=(M()-e.outerHeight(!0))/2-d.amsl;return j>a?j:a}function K(){return(N()-e.outerWidth(!0))/2}function L(){return M()>e.outerHeight(!0)+j&&N()>e.outerWidth(!0)+j}function M(){return window.innerHeight||g.height()}function N(){return window.innerWidth||g.width()}var d,m,n,o,p,q,r,s,t,u,v,e,f,g,h,i,j,k;return a.isFunction(b)&&(c=b,b=null),d=a.extend({},a.fn.bPopup.defaults,b),d.scrollBar||a("html").css("overflow","hidden"),e=this,f=a(document),g=a(window),h="__b-popup",i=/OS 6(_\d)+/i.test(navigator.userAgent),j=20,k=0,e.close=function(){d=this.data("bPopup"),m=h+g.data("bPopup")+"__",z()},e.each(function(){a(this).data("bPopup")||w()})},a.fn.bPopup.defaults={amsl:50,appending:!0,appendTo:"body",closeClass:"b-close",closeId:"#b-close",content:"ajax",contentContainer:!1,easing:"swing",escClose:!0,follow:[!0,!0],followEasing:"swing",followSpeed:500,loadCallback:!1,loadData:!1,loadUrl:!1,modal:!0,modalClose:!0,modalColor:"#000",onClose:!1,onOpen:!1,opacity:.7,position:["auto","auto"],positionStyle:"absolute",scrollBar:!0,speed:250,transition:"fadeIn",zIndex:9997}}(jQuery);